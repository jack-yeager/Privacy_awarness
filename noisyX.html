<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Regression with Differential Privacy</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Linear Regression with Differential Privacy</h1>

    <label for="noiseType">Select Noise Type:</label>
    <select id="noiseType" onchange="updatePlot()">
        <option value="Laplace">Laplace</option>
        <option value="Gaussian">Gaussian</option>
    </select>

    <label for="epsilon">Epsilon:</label>
    <input type="range" id="epsilon" min="0.01" max="20" step="0.01" value="1" onchange="updatePlot()">
    <span id="epsilonValue">1</span>

    <div id="plot"></div>

    <script>
        // Generate initial data
        const npRandomSeed = (seed) => {
            let m_w = seed;
            let m_z = 987654321;
            const mask = 0xffffffff;

            return function () {
                m_z = (36969 * (m_z & 65535) + (m_z >> 16)) & mask;
                m_w = (18000 * (m_w & 65535) + (m_w >> 16)) & mask;
                let result = ((m_z << 16) + (m_w & 65535)) >>> 0;
                result /= 4294967296;
                return result + 0.5;
            };
        };

        const random = npRandomSeed(42);
        const X = Array.from({ length: 100 }, () => random() * 10);
        const y = X.map(x => 2.5 * x + (random() - 0.5) * 4);

        // Linear regression function
        function olsRegression(X, y) {
            const xMean = X.reduce((a, b) => a + b, 0) / X.length;
            const yMean = y.reduce((a, b) => a + b, 0) / y.length;

            const num = X.reduce((acc, x, i) => acc + (x - xMean) * (y[i] - yMean), 0);
            const denom = X.reduce((acc, x) => acc + Math.pow(x - xMean, 2), 0);

            const slope = num / denom;
            const intercept = yMean - slope * xMean;

            return { slope, intercept };
        }

        // Noise functions
        function addGaussianNoise(values, epsilon, delta = 1e-5, sensitivity = 1) {
            const sigma = Math.sqrt(2 * Math.log(1.25 / delta)) * sensitivity / epsilon;
            return values.map(v => v + (random() - 0.5) * sigma);
        }

        function addLaplaceNoise(values, epsilon, sensitivity = 1) {
            const scale = sensitivity / epsilon;
            return values.map(v => v + scale * (Math.log(1 - random()) - Math.log(random())));
        }

        // Update the plot
        function updatePlot() {
            const noiseType = document.getElementById('noiseType').value;
            const epsilon = parseFloat(document.getElementById('epsilon').value);
            document.getElementById('epsilonValue').innerText = epsilon;

            // Add noise to X based on noise type
            let X_noisy;
            if (noiseType === 'Laplace') {
                X_noisy = addLaplaceNoise(X, epsilon);
            } else {
                X_noisy = addGaussianNoise(X, epsilon);
            }

            // Perform regression on noisy data
            const regressionNoisy = olsRegression(X_noisy, y);
            const regressionOriginal = olsRegression(X, y);

            // Generate data points for the line
            const X_line = [...Array(100).keys()].map(i => i / 10);
            const y_noisy = X_line.map(x => regressionNoisy.slope * x + regressionNoisy.intercept);
            const y_original = X_line.map(x => regressionOriginal.slope * x + regressionOriginal.intercept);

            // Plot using Plotly
            const data = [
                {
                    x: X,
                    y: y,
                    mode: 'markers',
                    type: 'scatter',
                    name: 'Data',
                    marker: { color: 'red' }
                },
                {
                    x: X_line,
                    y: y_original,
                    mode: 'lines',
                    name: 'Without Noise',
                    line: { color: 'yellow' }
                },
                {
                    x: X_line,
                    y: y_noisy,
                    mode: 'lines',
                    name: `With ${noiseType} Noise (Îµ=${epsilon})`,
                    line: { color: 'blue' }
                }
            ];

            const layout = {
                title: `Effect of Epsilon=${epsilon} with ${noiseType} noise`,
                xaxis: { title: 'X' },
                yaxis: { title: 'y' },
            };

            Plotly.newPlot('plot', data, layout);
        }

        // Initialize plot
        window.onload = updatePlot;
    </script>
</body>
</html>
