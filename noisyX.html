<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Regression with Differential Privacy</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Linear Regression with Differential Privacy</h1>

    <label for="noiseType">Select Noise Type:</label>
    <select id="noiseType" onchange="updatePlot()">
        <option value="Laplace">Laplace</option>
        <option value="Gaussian">Gaussian</option>
    </select>

    <label for="epsilon">Epsilon:</label>
    <input type="range" id="epsilon" min="0.01" max="20" step="0.01" value="1" onchange="updatePlot()">
    <span id="epsilonValue">1</span>

    <canvas id="chart" width="800" height="600"></canvas>

    <script>
        // Generate initial data
        const randomSeed = (() => {
            let seed = 42;
            return () => {
                const x = Math.sin(seed++) * 10000;
                return x - Math.floor(x);
            };
        })();

        const X = Array.from({ length: 100 }, () => randomSeed() * 10);
        const y = X.map(x => 2.5 * x + (randomSeed() - 0.5) * 4);

        // Linear regression function
        function olsRegression(X, y) {
            const xMean = X.reduce((a, b) => a + b, 0) / X.length;
            const yMean = y.reduce((a, b) => a + b, 0) / y.length;

            const num = X.reduce((acc, x, i) => acc + (x - xMean) * (y[i] - yMean), 0);
            const denom = X.reduce((acc, x) => acc + Math.pow(x - xMean, 2), 0);

            const slope = num / denom;
            const intercept = yMean - slope * xMean;

            return { slope, intercept };
        }

        // Noise functions
        function addGaussianNoise(values, epsilon, delta = 1e-5, sensitivity = 1) {
            const sigma = Math.sqrt(2 * Math.log(1.25 / delta)) * sensitivity / epsilon;
            return values.map(v => v + (randomSeed() - 0.5) * sigma);
        }

        function addLaplaceNoise(values, epsilon, sensitivity = 1) {
            const scale = sensitivity / epsilon;
            return values.map(v => v + scale * (Math.log(1 - randomSeed()) - Math.log(randomSeed())));
        }

        // Initialize Chart.js
        let chart = new Chart(document.getElementById('chart').getContext('2d'), {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'Data',
                        data: X.map((x, i) => ({ x, y: y[i] })),
                        backgroundColor: 'red',
                        pointRadius: 3
                    },
                    {
                        label: 'Without Noise',
                        data: [],
                        type: 'line',
                        borderColor: 'yellow',
                        borderWidth: 2,
                        fill: false
                    },
                    {
                        label: 'With Noise',
                        data: [],
                        type: 'line',
                        borderColor: 'blue',
                        borderWidth: 2,
                        fill: false
                    }
                ]
            },
            options: {
                scales: {
                    x: { type: 'linear', position: 'bottom', title: { display: true, text: 'X' } },
                    y: { title: { display: true, text: 'y' } }
                },
                plugins: {
                    legend: { position: 'top' }
                }
            }
        });

        // Update the plot
        function updatePlot() {
            const noiseType = document.getElementById('noiseType').value;
            const epsilon = parseFloat(document.getElementById('epsilon').value);
            document.getElementById('epsilonValue').innerText = epsilon;

            // Add noise to X based on noise type
            let X_noisy;
            if (noiseType === 'Laplace') {
                X_noisy = addLaplaceNoise(X, epsilon);
            } else {
                X_noisy = addGaussianNoise(X, epsilon);
            }

            // Perform regression on noisy and original data
            const regressionNoisy = olsRegression(X_noisy, y);
            const regressionOriginal = olsRegression(X, y);

            // Generate data points for regression lines
            const X_line = Array.from({ length: 100 }, (_, i) => i / 10);
            const y_noisy = X_line.map(x => regressionNoisy.slope * x + regressionNoisy.intercept);
            const y_original = X_line.map(x => regressionOriginal.slope * x + regressionOriginal.intercept);

            // Update chart data
            chart.data.datasets[1].data = X_line.map((x, i) => ({ x, y: y_original[i] }));
            chart.data.datasets[2].data = X_line.map((x, i) => ({ x, y: y_noisy[i] }));

            // Redraw chart
            chart.update();
        }

        // Initial plot load
        window.onload = updatePlot;
    </script>
</body>
</html>
