<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Noise Plot with Chart.js</title>
    
    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />

    <py-config>
        packages = ["numpy", "ipywidgets"]
    </py-config>

    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .pyscript-container {
            width: 80%;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    
    <h1>Interactive Noise Plot</h1>
    <p>Select a noise type and adjust the epsilon value to see its effect:</p>
    
    <div id="plot-container">
        <canvas id="noisePlot"></canvas>
    </div>
    
    <py-script>
        import numpy as np
        from ipywidgets import interact, widgets
        from js import document

        # Simulated data for demonstration
        X_test = np.linspace(1, 7, 100)  # Adjusted to integers 1 to 7
        y_test = 3 * X_test + 5 + np.random.normal(0, 3, size=X_test.shape)
        y_pred_olsr = 3 * X_test + 5
        X_test_b = np.c_[np.ones((100, 1)), X_test]  # Add bias term
        theta_ols = np.array([5, 3])  # Example OLS parameters

        # Laplace mechanism function
        def laplace_mechanism(theta, sensitivity, epsilon):
            noise = np.random.laplace(0, sensitivity / epsilon, size=theta.shape)
            return theta + noise

        # Gaussian noise function
        delta = 1e-5
        sensitivity = 1
        def add_gaussian_noise(theta, epsilon, delta, sensitivity):
            sigma = sensitivity * np.sqrt(2 * np.log(1.25 / delta)) / epsilon
            noise = np.random.normal(0, sigma, size=theta.shape)
            return theta + noise

        # Plot function
        def update_plot(noise_type, epsilon):
            if noise_type == 'Laplace':
                y_vary_noise = X_test_b.dot(laplace_mechanism(theta_ols, 1, epsilon))
                noise_label = 'with Laplace noise'
            elif noise_type == 'Gaussian':
                y_vary_noise = X_test_b.dot(add_gaussian_noise(theta_ols, epsilon, delta, sensitivity))
                noise_label = 'with Gaussian noise'

            # Prepare data for Chart.js
            data = {
                'labels': X_test.tolist(),
                'datasets': [
                    {
                        'label': noise_label,
                        'data': y_vary_noise.tolist(),
                        'borderColor': 'blue',
                        'fill': False,
                    },
                    {
                        'label': 'Test Data',
                        'data': y_test.tolist(),
                        'borderColor': 'red',
                        'fill': False,
                        'pointRadius': 3,
                        'showLine': False,
                    },
                    {
                        'label': 'Without Noise',
                        'data': y_pred_olsr.tolist(),
                        'borderColor': 'yellow',
                        'fill': False,
                    },
                ]
            }

            # Chart configuration
            config = {
                'type': 'line',
                'data': data,
                'options': {
                    'scales': {
                        'x': {
                            'beginAtZero': True,
                        },
                        'y': {
                            'beginAtZero': True,
                            'min': -10,  # Set appropriate limits based on your data
                            'max': 40,   # Adjust according to your dataset
                        }
                    }
                }
            }

            # Render the chart
            chart_canvas = document.getElementById('noisePlot')
            chart = window.Chart(chart_canvas, config)

        # Create an interactive plot
        interact(update_plot,
                 noise_type=widgets.Dropdown(options=['Laplace', 'Gaussian'], value='Laplace', description='Noise Type:'),
                 epsilon=widgets.FloatSlider(value=1, min=0.01, max=20, step=0.01, description='Epsilon:'));
    </py-script>
</body>
</html>
